## Lab 2. Deploying the model using Flask framework locally and on Azure App Service. Setting up Email Automation Workflow on Azure Logic.


### Task 1 : Deploy the model by running the Flask wrapper locally

1. Navigate to **Microsoft Azure Machine Learning Studio** and click on **Open Terminal**.

   ![](Images/terminal.png)
   
1. Navigate to the required path by running the below given command on the Terminal page:

    ```
    cd artifacts/openai-model/flask-app
    ```
1. Run the below mentioned command to run the Flask wrapper and copy the generated local host URl:

   ```
   flask run
   ```
   ![](Images/localhosturl.png)
   
### Task 2: Test the locally-deployed API with specified request/response formats

1. Navigate to the **notebooks** folder, select **flask-app-test.ipynb (1)** file and select the kernal as **Python 3.8-Jupyter (2)**.

   ![](Images/apptestlocally.png)
    
1. Run each cell one after the other and observe the output. Make sure you update the URL **https://techimmersionsfopen.azurewebsites.net** with the local host URL that you have copied in Task-1/Step-3.

   ![](Images/url.png)
    
### Task 3: Deploy the model on Azure App Service

1. In Azure Machine Learning Studio, open a new terminal and run the below given commands:

   ```
   cd artifacts
   ```
   
   ![](Images/artifacts.png)
   
   - Before running the below command update **<DID>** with **<inject key="DeploymentID" enableCopy="false"/>**.
   
   ```
   tar -czvf openai-model.zip ~/cloudfiles/code/Users/odl_user_<DID>/artifacts/openai-model
   ```
   
   - Run the below command to login into the azure portal.
   ```
   az login --identity
   ```
   - Navigate to the Device Login URL to sign in to the Azure Portal.

   ![](/Images/authenticate.png)
   
   - Enter the **Authentication code (1)** and click on **Next (2)**.
   
   ![](Images/entercode.png)
   
   - Select your Azure account

   ![](Images/chooseaccount.png)
   
   - On **Are you trying to sign in to Microsoft Azure CLI** page, click on  **Continue**.

   ![](Images/continue.png)
   
   - Before running the below command update **<DID>** with **<inject key="DeploymentID" enableCopy="false"/>**.
   
   ```
   cd ..
   az webapp deploy --resource-group ODL-AzureAI-MS-<DID> --name openaiwebapp<DID> --src-path artifacts/openai-model.zip --type=startup
   ```
   
### Task 4: Test the cloud-deployed API with specified request/response formats


### Task 5 : Setup email automation workflow on Azure Logic Apps using
